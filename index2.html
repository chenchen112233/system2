<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¾å®¹çš®è†šç®¡ç†é¡§å®¢ç³»çµ±</title>
    <style>
        :root {
            --bg-color: #F7F4EF;
            --card-bg: #FFFFFF;
            --text-main: #5D4037;
            --text-light: #8D6E63;
            --accent-color: #D7CCC8;
            --primary-btn: #8D6E63;
            --btn-text: #FFFFFF;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            font-family: "PingFang TC", "Noto Sans TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; 
        }

        .view {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            background: var(--bg-color);
            transition: transform 0.3s ease;
            overflow-y: auto; padding: 20px;
        }

        .view.hidden { transform: translateX(100%); display: none; }
        
        h2 { font-size: 22px; margin: 10px 0 20px 0; color: var(--text-main); text-align: center; }
        h3 { font-size: 16px; margin: 25px 0 10px 0; border-left: 4px solid var(--text-light); padding-left: 10px; color: var(--text-main); }
        
        .search-box { position: sticky; top: 0; z-index: 10; background: var(--bg-color); padding-bottom: 10px; }
        .search-input {
            width: 100%; padding: 15px; border: none; border-radius: 50px;
            background: #FFF; box-shadow: 0 4px 15px rgba(93, 64, 55, 0.08);
            font-size: 16px; color: var(--text-main); outline: none; text-align: center;
        }

        .customer-list { margin-top: 10px; padding-bottom: 80px; }
        .customer-card {
            background: #FFF; border-radius: 16px; padding: 15px 20px; margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03); display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; transition: transform 0.1s;
        }
        .customer-card:active { transform: scale(0.98); }
        .c-name { font-size: 18px; font-weight: bold; }
        .c-phone { font-size: 14px; color: var(--text-light); }
        
        .fab-btn {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: var(--primary-btn); color: white; padding: 15px 30px; border-radius: 50px;
            font-size: 16px; font-weight: bold; box-shadow: 0 5px 20px rgba(141, 110, 99, 0.4);
            border: none; cursor: pointer; z-index: 100; display: flex; align-items: center; gap: 8px;
        }

        .top-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .back-btn, .save-btn { background: none; border: none; color: var(--text-light); font-size: 16px; cursor: pointer; padding: 10px; }
        .save-btn { color: var(--primary-btn); font-weight: bold; }

        .form-section { background: #FFF; padding: 20px; border-radius: 16px; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 13px; color: var(--text-light); margin-bottom: 5px; font-weight: 500; }
        input[type="text"], input[type="date"], input[type="tel"], input[type="number"] {
            width: 100%; padding: 8px 0; border: none; border-bottom: 1px solid #D7CCC8;
            background: transparent; font-size: 16px; outline: none; border-radius: 0; color: var(--text-main);
        }
        
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 5px; }
        .checkbox-item { display: flex; align-items: center; font-size: 15px; cursor: pointer; min-height: 25px; }
        .checkbox-item input { margin-right: 8px; accent-color: var(--text-light); width: 18px; height: 18px; }

        .record-item { border-left: 3px solid var(--accent-color); padding-left: 15px; margin-bottom: 20px; position: relative; }
        .record-title { font-size: 16px; font-weight: bold; color: var(--text-main); }
        .record-date { font-size: 12px; color: var(--text-light); margin-top: 2px;}
        .record-content { font-size: 14px; margin: 4px 0; font-weight: 500; color: #555; }
        .record-meta { font-size: 13px; color: #888; }
        .delete-record { position: absolute; right: 0; top: 0; color: #ff6b6b; font-size: 12px; cursor: pointer; padding: 5px; }

        .tabs { display: flex; background: #EFEBE9; padding: 4px; border-radius: 30px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; color: var(--text-light); border-radius: 25px; transition: 0.3s; font-weight: bold; }
        .tab-btn.active { background: #FFF; color: var(--text-main); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .tab-content { display: none; padding-bottom: 50px; }
        .tab-content.active { display: block; }

        /* é¡§å®¢åŒæ„è²æ˜æ¨£å¼ */
        .consent-box {
            background-color: #FAFAFA;
            border: 1px dashed #D7CCC8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            font-size: 12px;
            line-height: 1.6;
            color: #5D4037;
        }
        .consent-box ol { padding-left: 20px; margin: 0; }
        .consent-box li { margin-bottom: 5px; }

        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7); color: white; padding: 10px 20px;
            border-radius: 8px; display: none; z-index: 200;
        }
        
        .backup-area { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px dashed #D7CCC8; }
        .backup-link { font-size: 12px; color: var(--text-light); text-decoration: underline; cursor: pointer; }

    </style>
</head>
<body>

<div id="home-view" class="view">
    <div style="text-align:center; padding: 20px 0;">
        <div style="font-size:14px; color:var(--text-light); letter-spacing: 2px;">BEAUTY STUDIO</div>
        <h2>é¡§å®¢è³‡æ–™ç®¡ç†</h2>
    </div>

    <div class="search-box">
        <input type="text" id="searchInput" class="search-input" placeholder="ğŸ” æœå°‹é¡§å®¢å§“å..." oninput="renderList()">
    </div>

    <div id="customerList" class="customer-list">
        </div>

    <button class="fab-btn" onclick="openEditor()">
        <span>ï¼‹ å»ºç«‹æ–°é¡§å®¢è³‡æ–™</span>
    </button>
    
    <div class="backup-area">
        <span class="backup-link" onclick="downloadBackup()">ğŸ“¥ ä¸‹è¼‰è³‡æ–™å‚™ä»½ (JSON)</span>
    </div>
</div>

<div id="editor-view" class="view hidden">
    <div class="top-nav">
        <button class="back-btn" onclick="goHome()">âœ• å–æ¶ˆ</button>
        <div style="font-weight:bold;">é¡§å®¢è³‡æ–™å¡</div>
        <button class="save-btn" onclick="saveCustomer()">âœ“ å„²å­˜</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('tab-info')">æ­£é¢ï¼šé¢è¨ºè³‡æ–™</button>
        <button class="tab-btn" onclick="switchTab('tab-record')">èƒŒé¢ï¼šèª²ç¨‹ç´€éŒ„</button>
    </div>

    <div id="tab-info" class="tab-content active">
        
        <div class="form-section">
            <h3>åŸºæœ¬è³‡æ–™</h3>
            <div class="form-group"><label>è«®è©¢æ—¥æœŸ DATE</label><input type="date" id="consultDate"></div>
            <div class="form-group"><label>è«®è©¢å¸« COUNSELOR</label><input type="text" id="counselor"></div>
            <div class="form-group"><label>å§“å NAME</label><input type="text" id="custName" placeholder="å¿…å¡«"></div>
            <div class="form-group">
                <label>æ€§åˆ¥ GENDER</label>
                <div class="checkbox-group">
                    <label class="checkbox-item"><input type="radio" name="gender" value="ç”·"> ç”·</label>
                    <label class="checkbox-item"><input type="radio" name="gender" value="å¥³"> å¥³</label>
                    <label class="checkbox-item"><input type="radio" name="gender" value="å…¶ä»–"> å…¶ä»–</label>
                </div>
            </div>
            <div class="form-group"><label>ç”Ÿæ—¥ BIRTHDAY</label><input type="date" id="birthday"></div>
            <div class="form-group"><label>é›»è©± TEL</label><input type="tel" id="tel"></div>
        </div>

        <div class="form-section">
            <h3>çš®è†šç‹€æ³ SKIN PROPERTIES</h3>
            <div class="form-group"><label>çš®è†šæ€§è³ª</label>
                <div class="checkbox-group">
                    <label class="checkbox-item"><input type="radio" name="skinType" value="ä¹¾æ€§"> ä¹¾æ€§</label>
                    <label class="checkbox-item"><input type="radio" name="skinType" value="æ²¹æ€§"> æ²¹æ€§</label>
                    <label class="checkbox-item"><input type="radio" name="skinType" value="æ··åˆæ€§"> æ··åˆæ€§</label>
                    <label class="checkbox-item"><input type="radio" name="skinType" value="æ•æ„Ÿæ€§"> æ•æ„Ÿæ€§</label>
                    <label class="checkbox-item"><input type="radio" name="skinType" value="ä¸­æ€§"> ä¸­æ€§</label>
                </div>
            </div>
            <div class="form-group"><label>è—¥ç‰©éæ•å²</label>
                <div class="checkbox-group">
                    <label class="checkbox-item"><input type="radio" name="drugAllergy" value="æœ‰"> æœ‰</label>
                    <label class="checkbox-item"><input type="radio" name="drugAllergy" value="ç„¡"> ç„¡</label>
                </div>
            </div>
            <div class="form-group"><label>éæ•åŸ ALLERGENS</label><input type="text" id="allergens"></div>
        </div>

        <div class="form-section">
            <h3>æœ€æƒ³æ”¹å–„çš„å•é¡Œ IMPROVING ISSUESï¼ˆå¯è¤‡é¸ï¼‰</h3>
            <div class="checkbox-group" style="flex-direction: column;">
                <label class="checkbox-item"><input type="checkbox" class="issue-cb" value="çš®è†šå‡ºæ²¹ã€æ¯›å­”ç²—å¤§"> çš®è†šå‡ºæ²¹ã€æ¯›å­”ç²—å¤§</label>
                <label class="checkbox-item"><input type="checkbox" class="issue-cb" value="æš—é»ƒã€è†šè‰²ä¸å‡"> æš—é»ƒã€è†šè‰²ä¸å‡</label>
                <label class="checkbox-item"><input type="checkbox" class="issue-cb" value="çš®è†šä¹¾ç‡¥ç¼ºæ°´"> çš®è†šä¹¾ç‡¥ç¼ºæ°´</label>
                <label class="checkbox-item"><input type="checkbox" class="issue-cb" value="ç²‰åˆºç—˜ç—˜"> ç²‰åˆºç—˜ç—˜</label>
                <label class="checkbox-item"><input type="checkbox" class="issue-cb" value="é¬†å¼›ã€æå‡ç·Šç·»"> é¬†å¼›ã€æå‡ç·Šç·»</label>
                <label class="checkbox-item"><input type="checkbox" class="issue-cb" value="æ–‘é»ã€é›€æ–‘ã€è‰²ç´ "> æ–‘é»ã€é›€æ–‘ã€è‰²ç´ </label>
                <label class="checkbox-item"><input type="checkbox" class="issue-cb" value="é¢éƒ¨æ³›ç´…è¡€çµ²ã€æ•æ„Ÿ"> é¢éƒ¨æ³›ç´…è¡€çµ²ã€æ•æ„Ÿ</label>
            </div>
        </div>

        <div class="form-section">
            <h3>å¤šä¹…åšä¸€æ¬¡é¢éƒ¨è­·ç† HOW LONG</h3>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="radio" name="howLong" value="å …æŒå®šæœŸ"> å …æŒå®šæœŸ</label>
                <label class="checkbox-item"><input type="radio" name="howLong" value="ä¸ç¶“å¸¸"> ä¸ç¶“å¸¸</label>
                <label class="checkbox-item"><input type="radio" name="howLong" value="å¶çˆ¾"> å¶çˆ¾</label>
                <label class="checkbox-item"><input type="radio" name="howLong" value="æœªæ›¾"> æœªæ›¾</label>
            </div>
        </div>

        <div class="form-section">
            <h3>ä»¥å‰åšéå“ªäº›çš®è†šç®¡ç† SKIN MANAGEMENTï¼ˆå¯è¤‡é¸ï¼‰</h3>
            <div class="checkbox-group" style="flex-direction: column;">
                <label class="checkbox-item"><input type="checkbox" class="history-cb" value="ç”Ÿæ´»ç¾å®¹"> ç”Ÿæ´»ç¾å®¹</label>
                <label class="checkbox-item"><input type="checkbox" class="history-cb" value="å„€å™¨å°å…¥"> å„€å™¨å°å…¥</label>
                <label class="checkbox-item"><input type="checkbox" class="history-cb" value="å±…å®¶ç”¢å“"> å±…å®¶ç”¢å“</label>
                <label class="checkbox-item"><input type="checkbox" class="history-cb" value="å…‰é›»å„€å™¨"> å…‰é›»å„€å™¨</label>
                <label class="checkbox-item"><input type="checkbox" class="history-cb" value="å¾®é‡"> å¾®é‡</label>
                <label class="checkbox-item"><input type="checkbox" class="history-cb" value="æ°´å…‰é‡"> æ°´å…‰é‡</label>
                <div style="display:flex; align-items:center; width:100%;">
                    <input type="checkbox" class="history-cb" value="å…¶ä»–" id="historyOtherCheck"> 
                    <span style="margin-left:5px; margin-right:5px;">å…¶ä»–ï¼š</span>
                    <input type="text" id="historyOtherText" style="flex:1;">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>èº«é«”ç‹€æ³ PHYSICAL CONDITION</h3>
            <div class="form-group">
                <label>ç¡çœ ï¼š</label>
                <div class="checkbox-group">
                    <label class="checkbox-item"><input type="radio" name="sleep" value="æ­£å¸¸"> æ­£å¸¸</label>
                    <label class="checkbox-item"><input type="radio" name="sleep" value="æœ‰æ™‚ç†¬å¤œ"> æœ‰æ™‚ç†¬å¤œ</label>
                    <label class="checkbox-item"><input type="radio" name="sleep" value="ç¶“å¸¸ç†¬å¤œ"> ç¶“å¸¸ç†¬å¤œ</label>
                    <label class="checkbox-item"><input type="radio" name="sleep" value="å¤±çœ "> å¤±çœ </label>
                </div>
            </div>
            <div class="form-group">
                <label>é£²é£Ÿï¼š</label>
                <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" class="diet-cb" value="ç‡Ÿé¤Šå‡è¡¡"> ç‡Ÿé¤Šå‡è¡¡</label>
                    <label class="checkbox-item"><input type="checkbox" class="diet-cb" value="ç´ é£Ÿè€…"> ç´ é£Ÿè€…</label>
                    <label class="checkbox-item"><input type="checkbox" class="diet-cb" value="é£²é…’"> é£²é…’</label>
                    <label class="checkbox-item"><input type="checkbox" class="diet-cb" value="è¾›è¾£"> è¾›è¾£</label>
                    <label class="checkbox-item"><input type="checkbox" class="diet-cb" value="æ²¹è†©"> æ²¹è†©</label>
                    <label class="checkbox-item"><input type="checkbox" class="diet-cb" value="å¥¶èŒ¶å’–å•¡"> å¥¶èŒ¶å’–å•¡</label>
                </div>
            </div>
        </div>

        <div class="consent-box">
            <strong>é¡§å®¢åŒæ„èˆ‡æ³•è¦è²æ˜</strong>
            <ol>
                <li>æœ¬äººç¢ºèªä»¥ä¸Šå¡«å¯«è³‡æ–™çš†ç‚ºæœ¬äººçœŸå¯¦ç‹€æ³ï¼Œä¸¦åŒæ„æä¾›äºˆæœ¬å·¥ä½œå®¤ä½œç‚ºçš®è†šç®¡ç†èˆ‡æœå‹™ç´€éŒ„ä½¿ç”¨ã€‚</li>
                <li>æœ¬äººäº†è§£æœ¬å·¥ä½œå®¤æ‰€æä¾›ä¹‹æœå‹™å±¬æ–¼ã€Œéé†«ç™‚ç¾å®¹ï¼çš®è†šç®¡ç†è¡Œç‚ºã€ï¼Œä¸æ¶‰åŠä»»ä½•é†«ç™‚è¨ºæ–·ã€æ²»ç™‚æˆ–ç™‚æ•ˆä¿è­‰ã€‚</li>
                <li>æœ¬äººå·²å……åˆ†äº†è§£æœå‹™å…§å®¹ã€æµç¨‹åŠå¯èƒ½ç”¢ç”Ÿä¹‹æš«æ™‚æ€§è‚Œè†šåæ‡‰ï¼Œä¸¦åŒæ„æ¥å—ç›¸é—œæœå‹™ã€‚</li>
            </ol>
        </div>
    </div>

    <div id="tab-record" class="tab-content">
        <div class="form-section">
            <h3 style="margin-top:0;">æ–°å¢èª²ç¨‹ç´€éŒ„</h3>
            <div class="form-group"><label>èª²ç¨‹ç´€éŒ„åç¨± Title</label><input type="text" id="recTitle" placeholder="ä¾‹å¦‚ï¼šæ°´é£›æ¢­æ·±å±¤æ¸…æ½”"></div>
            <div class="form-group"><label>æœå‹™æ—¥æœŸ DATE</label><input type="date" id="recDate"></div>
            <div class="form-group"><label>èª²ç¨‹ï¼æœå‹™å…§å®¹ COURSE CONTENT</label><input type="text" id="recContent" placeholder="è¼¸å…¥æ“ä½œå…§å®¹"></div>
            <div style="display:flex; gap:10px;">
                <div class="form-group" style="flex:1;"><label>é‡‘é¡ AMOUNT (TWD)</label><input type="number" id="recAmount"></div>
                <div class="form-group" style="flex:1;"><label>æ“ä½œäººå“¡</label><input type="text" id="recOperator"></div>
            </div>
            <button onclick="addRecordItem()" style="width:100%; padding:10px; background:#EFEBE9; border:none; border-radius:8px; color:#5D4037; font-weight:bold;">ï¼‹ åŠ å…¥æ­¤ç­†ç´€éŒ„</button>
        </div>

        <div id="recordsContainer" style="padding-bottom:50px;">
            </div>
    </div>
</div>

<div id="toast" class="toast">å„²å­˜æˆåŠŸ</div>

<script>
    let customers = [];
    let currentId = null;

    function init() {
        const stored = localStorage.getItem('skinCareData_v2'); // ä½¿ç”¨ v2 ä»¥é˜²èˆŠæ ¼å¼è¡çª
        if (stored) { customers = JSON.parse(stored); }
        renderList();
        
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('recDate').value = today;
    }

    function renderList() {
        const query = document.getElementById('searchInput').value.trim();
        const container = document.getElementById('customerList');
        container.innerHTML = '';

        const filtered = customers.filter(c => c.name.includes(query));

        if (filtered.length === 0) {
            container.innerHTML = '<div style="text-align:center; color:#ccc; margin-top:30px;">æŸ¥ç„¡è³‡æ–™</div>';
            return;
        }

        filtered.sort((a, b) => b.updatedAt - a.updatedAt);

        filtered.forEach(c => {
            const div = document.createElement('div');
            div.className = 'customer-card';
            div.innerHTML = `
                <div>
                    <div class="c-name">${c.name}</div>
                    <div class="c-phone">${c.tel || 'æœªå¡«é›»è©±'}</div>
                </div>
                <div style="font-size:20px; color:#D7CCC8;">â€º</div>
            `;
            div.onclick = () => openEditor(c.id);
            container.appendChild(div);
        });
    }

    function goHome() {
        document.getElementById('home-view').style.display = 'flex';
        document.getElementById('editor-view').classList.add('hidden');
        setTimeout(() => document.getElementById('editor-view').style.display = 'none', 300);
        renderList();
    }

    function openEditor(id = null) {
        document.getElementById('home-view').style.display = 'none';
        const editor = document.getElementById('editor-view');
        editor.style.display = 'flex';
        setTimeout(() => editor.classList.remove('hidden'), 10);
        
        currentId = id;
        clearForm();
        
        if (id) {
            const data = customers.find(c => c.id === id);
            if (data) loadDataToForm(data);
        }
    }

    function switchTab(tabId) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        const btns = document.querySelectorAll('.tab-btn');
        if(tabId === 'tab-info') btns[0].classList.add('active');
        else btns[1].classList.add('active');

        document.getElementById(tabId).classList.add('active');
    }

    function clearForm() {
        document.querySelectorAll('input').forEach(i => {
            if(i.type === 'radio' || i.type === 'checkbox') i.checked = false;
            else if(i.id !== 'recDate') i.value = '';
        });
        document.getElementById('recordsContainer').innerHTML = '';
        switchTab('tab-info');
    }

    function loadDataToForm(data) {
        document.getElementById('consultDate').value = data.consultDate || '';
        document.getElementById('counselor').value = data.counselor || '';
        document.getElementById('custName').value = data.name || '';
        document.getElementById('birthday').value = data.birthday || '';
        document.getElementById('tel').value = data.tel || '';
        document.getElementById('allergens').value = data.allergens || '';
        document.getElementById('historyOtherText').value = data.historyOtherText || '';

        setRadio('gender', data.gender);
        setRadio('skinType', data.skinType);
        setRadio('drugAllergy', data.drugAllergy);
        setRadio('howLong', data.howLong);
        setRadio('sleep', data.sleep);

        loadCheckboxes('.issue-cb', data.issues);
        loadCheckboxes('.history-cb', data.history);
        loadCheckboxes('.diet-cb', data.diet);

        if (data.records) {
            data.records.forEach(r => renderRecordItem(r));
        }
    }

    function setRadio(name, value) {
        if (!value) return;
        const radios = document.getElementsByName(name);
        for (let r of radios) { if (r.value === value) r.checked = true; }
    }

    function loadCheckboxes(selector, dataArray) {
        if (!dataArray) return;
        document.querySelectorAll(selector).forEach(cb => {
            if (dataArray.includes(cb.value)) cb.checked = true;
        });
    }

    function saveCustomer() {
        const name = document.getElementById('custName').value.trim();
        if (!name) { alert('è«‹å¡«å¯«å§“å'); return; }

        let issues = getCheckboxes('.issue-cb');
        let history = getCheckboxes('.history-cb');
        let diet = getCheckboxes('.diet-cb');

        let currentRecords = [];
        document.querySelectorAll('.record-item').forEach(item => {
            currentRecords.push({
                title: item.dataset.title,
                date: item.dataset.date,
                content: item.dataset.content,
                amount: item.dataset.amount,
                operator: item.dataset.operator
            });
        });

        // æ’åºç´€éŒ„
        currentRecords.sort((a, b) => new Date(b.date) - new Date(a.date));

        const newCustomer = {
            id: currentId || Date.now().toString(),
            updatedAt: Date.now(),
            name: name,
            consultDate: document.getElementById('consultDate').value,
            counselor: document.getElementById('counselor').value,
            gender: getRadio('gender'),
            birthday: document.getElementById('birthday').value,
            tel: document.getElementById('tel').value,
            skinType: getRadio('skinType'),
            drugAllergy: getRadio('drugAllergy'),
            allergens: document.getElementById('allergens').value,
            howLong: getRadio('howLong'),
            sleep: getRadio('sleep'),
            historyOtherText: document.getElementById('historyOtherText').value,
            issues: issues,
            history: history,
            diet: diet,
            records: currentRecords
        };

        if (currentId) {
            const index = customers.findIndex(c => c.id === currentId);
            customers[index] = newCustomer;
        } else {
            customers.push(newCustomer);
        }

        localStorage.setItem('skinCareData_v2', JSON.stringify(customers));
        showToast('å„²å­˜æˆåŠŸ');
        setTimeout(goHome, 800);
    }

    function getRadio(name) {
        return document.querySelector(`input[name="${name}"]:checked`)?.value;
    }

    function getCheckboxes(selector) {
        let arr = [];
        document.querySelectorAll(selector + ':checked').forEach(cb => arr.push(cb.value));
        return arr;
    }

    function addRecordItem() {
        const title = document.getElementById('recTitle').value;
        const date = document.getElementById('recDate').value;
        const content = document.getElementById('recContent').value;
        const amount = document.getElementById('recAmount').value;
        const operator = document.getElementById('recOperator').value;

        if (!title && !content) { alert('è«‹å¡«å¯«èª²ç¨‹åç¨±æˆ–å…§å®¹'); return; }

        const record = { title, date, content, amount, operator };
        renderRecordItem(record, true);

        // æ¸…ç©ºæ¬„ä½ä½†ä¿ç•™æ—¥æœŸ
        document.getElementById('recTitle').value = '';
        document.getElementById('recContent').value = '';
        document.getElementById('recAmount').value = '';
    }

    function renderRecordItem(r, isNew = false) {
        const container = document.getElementById('recordsContainer');
        const div = document.createElement('div');
        div.className = 'record-item';
        div.dataset.title = r.title || '';
        div.dataset.date = r.date || '';
        div.dataset.content = r.content || '';
        div.dataset.amount = r.amount || '';
        div.dataset.operator = r.operator || '';

        div.innerHTML = `
            <div class="delete-record" onclick="this.parentElement.remove()">âœ• åˆªé™¤</div>
            <div class="record-title">${r.title || 'ç„¡æ¨™é¡Œ'}</div>
            <div class="record-date">${r.date}</div>
            <div class="record-content">${r.content}</div>
            <div class="record-meta">é‡‘é¡: $${r.amount || 0} / æ“ä½œ: ${r.operator || '-'}</div>
        `;
        
        if (isNew) container.prepend(div);
        else container.appendChild(div);
    }

    function downloadBackup() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(customers));
        const a = document.createElement('a');
        a.href = dataStr;
        a.download = "skin_sys_backup_" + new Date().toISOString().split('T')[0] + ".json";
        document.body.appendChild(a);
        a.click();
        a.remove();
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2000);
    }

    init();
</script>
</body>
</html>